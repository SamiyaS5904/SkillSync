<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Skill Sync - Mentor Dashboard</title>

  <!-- Tailwind + FontAwesome + Chart.js -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    body { background: linear-gradient(120deg,#071028 0%, #0b1220 50%, #111827 100%); }
    .glass { backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
    .task-done { text-decoration: line-through; opacity: .6; }
    .timeline-step { border-left: 3px dashed rgba(255,255,255,0.04); padding-left: 1rem; }
  </style>
</head>
<body class="min-h-screen text-slate-100 flex flex-col">

  <!-- TOP HERO -->
  <header class="max-w-5xl mx-auto text-center pt-12 px-4">
    <h1 class="text-4xl sm:text-5xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-pink-400">Your AI Career Mentor</h1>
    <p class="mt-3 text-slate-300">Tell us a bit about you — we will generate a formatted roadmap, daily schedule, playlists and show your progress like a proper SaaS.</p>
  </header>

  <main class="max-w-5xl mx-auto px-4 py-8 flex-1 space-y-8">

    <!-- ONBOARDING -->
    <section id="onboardSection" class="glass bg-slate-800/50 border border-slate-700 rounded-2xl p-6 shadow">
      <form id="onboardForm" class="space-y-4">
        <div class="grid sm:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium mb-2">Career Goal</label>
            <input id="goal" required class="w-full px-3 py-2 rounded-lg bg-slate-900/50 border border-slate-700" placeholder="e.g. Software Engineer, ML Engineer" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-2">Long-term goal</label>
            <input id="longGoal" class="w-full px-3 py-2 rounded-lg bg-slate-900/50 border border-slate-700" placeholder="e.g. FAANG job, build startup" />
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Current skills (comma separated)</label>
          <input id="skills" class="w-full px-3 py-2 rounded-lg bg-slate-900/50 border border-slate-700" placeholder="Python, HTML, Data Structures" />
        </div>

        <div class="grid sm:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium mb-2">Hours / weekday</label>
            <input id="hoursDay" type="number" min="0" class="w-full px-3 py-2 rounded-lg bg-slate-900/50 border border-slate-700" placeholder="e.g. 2" required />
          </div>
          <div>
            <label class="block text-sm font-medium mb-2">Hours / weekend day</label>
            <input id="hoursWeekend" type="number" min="0" class="w-full px-3 py-2 rounded-lg bg-slate-900/50 border border-slate-700" placeholder="e.g. 4" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-2">Start date</label>
            <input id="startDate" type="date" class="w-full px-3 py-2 rounded-lg bg-slate-900/50 border border-slate-700" />
          </div>
        </div>

        <div class="flex gap-3 mt-2">
          <button type="submit" class="px-4 py-2 rounded-lg bg-gradient-to-r from-indigo-500 to-fuchsia-600">Save & Continue</button>
          <button type="button" id="demoFill" class="px-4 py-2 rounded-lg bg-slate-700">Fill demo</button>
        </div>
      </form>
    </section>

    <!-- DASHBOARD (hidden until onboarding completed) -->
    <section id="dashboard" class="hidden space-y-6">

      <!-- TOP CTA Row: Roadmap / Plan / Playlists + Streak + Chart -->
      <div class="grid lg:grid-cols-3 gap-6 items-start">

        <!-- Large Card: Roadmap Preview -->
        <div class="glass bg-slate-800/50 border border-slate-700 rounded-2xl p-6 shadow lg:col-span-2">
          <div class="flex items-start justify-between">
            <div>
              <h2 class="text-xl font-semibold">Personalized Roadmap</h2>
              <p class="text-slate-400 mt-1">Nicely formatted steps & weeks — generated by AI (or mocked locally).</p>
            </div>
            <div class="flex items-center gap-3">
              <button id="regenerateRoadmap" class="px-3 py-2 rounded-lg bg-indigo-600">Regenerate</button>
              <button id="exportPdf" class="px-3 py-2 rounded-lg bg-slate-700">Export PDF</button>
            </div>
          </div>

          <div id="roadmapArea" class="mt-6 space-y-4">
            <!-- Roadmap timeline cards will be inserted here -->
          </div>
        </div>

        <!-- Right column: Streak + Progress Chart + Quick Actions -->
        <aside class="space-y-4">
          <div class="glass bg-slate-800/50 border border-slate-700 rounded-2xl p-4 text-center">
            <div id="streakBadge" class="mx-auto w-20 h-20 rounded-full border-4 border-indigo-500 flex items-center justify-center text-2xl font-extrabold bg-indigo-500/10">0</div>
            <p class="text-slate-300 mt-2">Current Streak</p>
            <p id="lastComplete" class="text-sm text-slate-400 mt-1"></p>
          </div>

          <div class="glass bg-slate-800/50 border border-slate-700 rounded-2xl p-4">
            <h3 class="font-semibold mb-2">Weekly Progress</h3>
            <canvas id="progressChart" width="300" height="200"></canvas>
          </div>

          <div class="glass bg-slate-800/50 border border-slate-700 rounded-2xl p-4 text-center">
            <button id="generatePlanBtn" class="w-full py-2 rounded-lg bg-gradient-to-r from-emerald-500 to-teal-600">Generate Daily Plan</button>
          </div>
        </aside>
      </div>

      <!-- Daily Schedule + Playlists -->
      <div class="grid lg:grid-cols-2 gap-6">
        <div class="glass bg-slate-800/50 border border-slate-700 rounded-2xl p-6">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold">Today's Schedule</h3>
            <div class="text-sm text-slate-400">Auto-saved</div>
          </div>
          <div id="scheduleArea" class="mt-4 space-y-3 timeline-step">
            <!-- schedule tasks will render here -->
          </div>
        </div>

        <div class="glass bg-slate-800/50 border border-slate-700 rounded-2xl p-6">
          <h3 class="font-semibold">Recommended Playlists</h3>
          <div id="playlistArea" class="mt-4 grid gap-3">
            <!-- playlist cards -->
          </div>
        </div>
      </div>

    </section>

  </main>

  <footer class="py-6 text-center text-slate-500 text-sm border-t border-slate-700">© 2025 Skill Sync</footer>

  <script>
    /* ---------- Utilities & Local Storage Keys ---------- */
    const LS_KEYS = {
      onboarding: 'ss_onboarding_v1',
      plan: 'ss_plan_v1',
      roadmap: 'ss_roadmap_v1',
      progress: 'ss_progress_v1',
      streak: 'ss_streak_v1'
    };

    function saveLS(key, value) { localStorage.setItem(key, JSON.stringify(value)); }
    function readLS(key, fallback=null) { try { const v=localStorage.getItem(key); return v?JSON.parse(v):fallback; } catch(e){return fallback;} }

    /* ---------- Onboarding Flow ---------- */
    const onboardForm = document.getElementById('onboardForm');
    const onboardSection = document.getElementById('onboardSection');
    const dashboard = document.getElementById('dashboard');

    document.getElementById('demoFill').addEventListener('click', ()=>{
      document.getElementById('goal').value = 'Software Engineer';
      document.getElementById('skills').value = 'Python, Data Structures, HTML';
      document.getElementById('longGoal').value = 'Get a SWE job at a good company';
      document.getElementById('hoursDay').value = 2;
      document.getElementById('hoursWeekend').value = 4;
      document.getElementById('startDate').value = new Date().toISOString().slice(0,10);
    });

    onboardForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      const onboarding = {
        goal: document.getElementById('goal').value.trim(),
        skills: document.getElementById('skills').value.trim(),
        longGoal: document.getElementById('longGoal').value.trim(),
        hoursDay: Number(document.getElementById('hoursDay').value)||0,
        hoursWeekend: Number(document.getElementById('hoursWeekend').value)||0,
        startDate: document.getElementById('startDate').value || new Date().toISOString().slice(0,10)
      };
      saveLS(LS_KEYS.onboarding, onboarding);
      onboardSection.classList.add('hidden');
      dashboard.classList.remove('hidden');
      initDashboard();

      // auto-generate roadmap & plan for immediate feedback
      generateRoadmap(true);
      generateDailyPlan(true);
    });

    /* ---------- Mock AI Generators (fallback) ---------- */
    function mockGenerateRoadmap(onboarding){
      // create 4-week roadmap based on hours
      const weeks = [];
      const base = onboarding.hoursDay >= 2 ? 'Practice daily problems' : 'Focus on fundamentals';
      weeks.push({title:'Week 1 — Foundations', desc:`Learn core topics: ${onboarding.skills || 'Programming basics'}. ${base}`, tasks:['Read basics','Watch intro videos','Try 5 exercises']});
      weeks.push({title:'Week 2 — Practice', desc:'Start solving problems and small projects', tasks:['Solve 10 easy problems','Build a mini feature']});
      weeks.push({title:'Week 3 — Project', desc:'Build and polish a small project', tasks:['Design project','Implement core features','Write README']});
      weeks.push({title:'Week 4 — Interviews', desc:'Revise and mock interviews', tasks:['Mock interviews','Revise tricky topics']});
      return weeks;
    }

    function mockGeneratePlan(onboarding){
      // break day into chunks
      const minutes = Math.max(15, onboarding.hoursDay*60 || 60);
      const chunk = Math.floor(minutes/3);
      const plan = [
        {time:'00:00', title:`Revise previous topics (${chunk} mins)`, duration:chunk},
        {time:'00:00', title:`Practice problems (${chunk} mins)`, duration:chunk},
        {time:'00:00', title:`Watch playlist / course (${minutes - chunk*2} mins)`, duration: minutes - chunk*2}
      ];
      // sample playlists
      const playlists = [
        {title:'DSA Crash Course - 10 videos', provider:'YouTube', url:'#', length:'5 hrs'},
        {title:'System Design Basics', provider:'Playlist', url:'#', length:'3 hrs'}
      ];
      return {plan, playlists};
    }

    /* ---------- Renderers ---------- */
    function renderRoadmap(weeks){
      const container = document.getElementById('roadmapArea');
      container.innerHTML = '';
      weeks.forEach((w, i)=>{
        const card = document.createElement('div');
        card.className = 'rounded-xl p-4 bg-slate-900/50 border border-slate-700';
        card.innerHTML = `<div class="flex items-start justify-between"><div><h4 class="font-semibold">${w.title}</h4><p class="text-slate-400 text-sm">${w.desc}</p></div><div class="text-sm text-slate-400">Week ${i+1}</div></div>`;
        const ul = document.createElement('ul'); ul.className='mt-3 list-disc pl-5 text-slate-300';
        (w.tasks||[]).forEach(t=>{ const li=document.createElement('li'); li.innerText=t; ul.appendChild(li); });
        card.appendChild(ul);
        container.appendChild(card);
      });
    }

    function renderDailySchedule(plan){
      const area = document.getElementById('scheduleArea'); area.innerHTML='';
      plan.forEach((p, idx)=>{
        const div = document.createElement('div');
        div.className = 'flex items-center gap-3 p-3 rounded-md bg-slate-900/40';
        div.innerHTML = `<input data-idx="${idx}" type="checkbox" class="task-check w-5 h-5" /> <div class="flex-1"><div class="flex justify-between"><div class="font-medium">${p.title}</div><div class="text-sm text-slate-400">${p.duration} min</div></div><div class="text-sm text-slate-400">${p.note||''}</div></div>`;
        area.appendChild(div);
      });
      // restore saved
      const saved = readLS(LS_KEYS.plan) || {};
      if(saved.checks){
        document.querySelectorAll('.task-check').forEach(ch=>{ const i=parseInt(ch.dataset.idx); if(saved.checks[i]) ch.checked=true; });
      }
    }

    function renderPlaylists(list){
      const area = document.getElementById('playlistArea'); area.innerHTML='';
      list.forEach(p=>{
        const card = document.createElement('div');
        card.className='p-3 rounded-md bg-slate-900/40 flex items-start gap-3';
        card.innerHTML = `<div class="flex-1"><div class="font-medium">${p.title}</div><div class="text-sm text-slate-400">${p.provider} • ${p.length||''}</div></div><a href="${p.url||'#'}" class="px-3 py-1 rounded bg-indigo-600">Open</a>`;
        area.appendChild(card);
      });
    }

    /* ---------- Chart: Weekly Progress ---------- */
    let progressChart = null;
    function initProgressChart(){
      const ctx = document.getElementById('progressChart').getContext('2d');
      const progress = readLS(LS_KEYS.progress) || [0,0,0,0,0,0,0];
      progressChart = new Chart(ctx, {
        type: 'bar',
        data: { labels:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'], datasets:[{label:'Completion %', data:progress, backgroundColor: 'rgba(56,189,248,0.4)', borderColor:'rgba(56,189,248,0.8)', borderWidth:1}] },
        options: { responsive:true, scales:{ y:{ beginAtZero:true, max:100 } } }
      });
    }
    function updateProgressForToday(percent){
      const arr = readLS(LS_KEYS.progress) || [0,0,0,0,0,0,0];
      const idx = new Date().getDay(); arr[idx] = Math.round(percent);
      saveLS(LS_KEYS.progress, arr); if(progressChart){ progressChart.data.datasets[0].data = arr; progressChart.update(); }
    }

    /* ---------- Streak Logic ---------- */
    function getToday(){ return new Date().toISOString().slice(0,10); }
    function initStreak(){ const s = readLS(LS_KEYS.streak) || {count:0, last: null}; document.getElementById('streakBadge').innerText = s.count; document.getElementById('lastComplete').innerText = s.last?('Last complete: '+s.last):''; }
    function incrementStreakIfNeeded(){ const s = readLS(LS_KEYS.streak) || {count:0,last:null}; const today = getToday(); if(s.last !== today){ s.count += 1; s.last = today; saveLS(LS_KEYS.streak,s); initStreak(); showToast('Streak increased 🎉'); } }

    /* ---------- Dashboard Init & Generation ---------- */
    function initDashboard(){ initProgressChart(); initStreak(); const onboard = readLS(LS_KEYS.onboarding); if(!onboard) return; document.title = `Skill Sync — ${onboard.goal}`; }

    async function generateRoadmap(forceMock=false){
      const onboard = readLS(LS_KEYS.onboarding);
      if(!onboard) return;
      const area = document.getElementById('roadmapArea'); area.innerHTML = '<p class="text-slate-300 animate-pulse">Generating roadmap...</p>';

      // attempt server-side API, else fallback to mock
      try{
        if(!forceMock){
          const res = await fetch('/api/generate-roadmap', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({onboarding:onboard})});
          if(res.ok){ const json = await res.json(); renderRoadmap(json.roadmap); saveLS(LS_KEYS.roadmap,json.roadmap); return; }
        }
      }catch(e){ /* ignore - fallback */ }
      // fallback
      const mock = mockGenerateRoadmap(onboard);
      renderRoadmap(mock);
      saveLS(LS_KEYS.roadmap,mock);
    }

    async function generateDailyPlan(forceMock=false){
      const onboard = readLS(LS_KEYS.onboarding);
      if(!onboard) return;
      const btn = document.getElementById('generatePlanBtn'); btn.disabled = true; btn.innerText = 'Generating...';
      try{
        if(!forceMock){
          const res = await fetch('/api/generate-plan', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({onboarding:onboard})});
          if(res.ok){ const json = await res.json(); renderDailySchedule(json.plan); renderPlaylists(json.playlists); saveLS(LS_KEYS.plan,{plan:json.plan,checks:[]}); initProgressChart(); btn.disabled = false; btn.innerText='Generate Daily Plan'; return; }
        }
      }catch(e){ /* ignore */ }

      // fallback mock
      const mock = mockGeneratePlan(onboard);
      renderDailySchedule(mock.plan); renderPlaylists(mock.playlists);
      saveLS(LS_KEYS.plan,{plan:mock.plan,checks:[]});
      btn.disabled = false; btn.innerText='Generate Daily Plan';
    }

    /* ---------- Task interactions ---------- */
    document.addEventListener('change', (e)=>{
      if(e.target && e.target.classList.contains('task-check')){
        const checks = Array.from(document.querySelectorAll('.task-check')).map(c=>c.checked);
        const saved = readLS(LS_KEYS.plan) || {plan:[], checks:[]}; saved.checks = checks; saveLS(LS_KEYS.plan,saved);
        // compute percent
        const pct = Math.round((checks.filter(Boolean).length / checks.length) * 100);
        updateProgressForToday(pct);
        if(checks.every(Boolean)){
          // all done -> increment streak once per day
          incrementStreakIfNeeded();
        }
      }
    });

    /* ---------- Simple Toast ---------- */
    function showToast(msg){ const d=document.createElement('div'); d.innerText=msg; d.className='fixed right-6 bottom-6 bg-emerald-600 text-white px-4 py-2 rounded shadow'; document.body.appendChild(d); setTimeout(()=>d.remove(),3000); }

    /* ---------- Wire up quick buttons ---------- */
    document.getElementById('regenerateRoadmap').addEventListener('click', ()=>generateRoadmap(true));
    document.getElementById('exportPdf').addEventListener('click', ()=>{ showToast('PDF export will be available in the next update.'); });
    document.getElementById('generatePlanBtn').addEventListener('click', ()=>generateDailyPlan(true));

    // if onboarding already present on load, show dashboard
    window.addEventListener('load', ()=>{
      if(readLS(LS_KEYS.onboarding)){
        onboardSection.classList.add('hidden'); dashboard.classList.remove('hidden'); initDashboard(); const savedPlan = readLS(LS_KEYS.plan); if(savedPlan && savedPlan.plan) renderDailySchedule(savedPlan.plan);
        const savedRoadmap = readLS(LS_KEYS.roadmap); if(savedRoadmap) renderRoadmap(savedRoadmap);
      }
    });

  </script>
</body>
</html>
